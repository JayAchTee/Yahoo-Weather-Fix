<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>Yahoo Weather Bad Link Work-Around</title>

	<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
	<script type="text/javascript" src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>

	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

	<!-- Optional theme -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">

	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
</head>
<body>
	<div class="navbar-wrapper">
		<div class="container">
			<nav class="navbar navbar-inverse  navbar-fixed-top">
				<div class="container">
					<div class="navbar-header">
						<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
							<span class="sr-only">Toggle navigation</span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						</button>
						<a class="navbar-brand" href="#">Project name</a>
					</div>
					<div id="navbar" class="navbar-collapse collapse">
						<ul class="nav navbar-nav">
							<li class="active"><a href="#">Home</a></li>
							<li><a href="#about">About</a></li>
							<li><a href="#contact">Contact</a></li>
							<li class="dropdown">
								<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Dropdown <span class="caret"></span></a>
								<ul class="dropdown-menu">
									<li><a href="#">Action</a></li>
									<li><a href="#">Another action</a></li>
									<li><a href="#">Something else here</a></li>
									<li role="separator" class="divider"></li>
									<li class="dropdown-header">And, for my encore ...</li>
									<li><a href="#">Separated link</a></li>
									<li><a href="#">One more separated link</a></li>
								</ul>
							</li>
						</ul>
					</div>
				</div>
			</nav>

		</div>
	</div>

	<!-- Carousel ================================================== -->
	<div id="myCarousel" class="carousel slide" data-ride="carousel">
		<!-- Indicators -->
		<ol class="carousel-indicators">
			<li data-target="#myCarousel" data-slide-to="0" class="active"></li>
			<li data-target="#myCarousel" data-slide-to="1"></li>
			<li data-target="#myCarousel" data-slide-to="2"></li>
		</ol>
		<div class="carousel-inner" role="listbox">
			<div class="item active">
				<div class="row">
					<div class="col-md-3"></div>
					<div class="col-md-6">
						<div id="first" class="container">
							<h3></h3>
							<p></p>
						</div>
					</div>
					<div class="col-md-3"></div>
				</div>
			</div>
			<div class="item">
				<div class="col-md-3"></div>
				<div class="col-md-6">
					<div id="second" class="container">
						<h3></h3>
						<p></p>
					</div>
				</div>
				<div class="col-md-3"></div>
			</div>
			<div class="item">
				<div class="col-md-3"></div>
				<div class="col-md-6">
					<div id="third" class="container">
						<h3></h3>
						<p></p>
					</div>
				</div>
				<div class="col-md-3"></div>
			</div>
		</div>

		<a class="left carousel-control" href="#myCarousel" role="button" data-slide="prev">
			<span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
			<span class="sr-only">Previous</span>
		</a>

		<a class="right carousel-control" href="#myCarousel" role="button" data-slide="next">
			<span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
			<span class="sr-only">Next</span>
		</a>
	</div>
	<!-- /Carousel ================================================== -->

	<footer class="footer">
		<div class="container">
			<p>&copy; 2015 by me. &middot; <a href="#">Privacy</a> &middot; <a href="#">Terms</a></p>
		</div>
	</footer>

	<div style="display: none;">
		<svg height="60px" width="30px">
			<polygon fill="silver" stroke-width="0" points="0,30 30,0 30,10 10,30 30,50 30,60">
			</polygon>
		</svg>

		<svg height="30px" width="15px">
			<polygon fill="silver" stroke-width="0" points="0,15 15,0 15,5 5,15 15,25 15,30">
			</polygon>
		</svg>
	</div>

	<style type="text/css" scoped="scoped">
		/* Sticky footer styles
		-------------------------------------------------- */
		html
		{
			position: relative;
			min-height: 100%;
		}

		body
		{
			margin-top: 60px;
			margin-bottom: 60px;
		}

		.footer
		{
			border-top: 2px solid grey;
			bottom: 0px;
			height: 32px;
			position: absolute;
			width: 100%;
		}
	</style>

	<script type="text/javascript">
		$(document).ready(function ()
		{
			Weather("first", "EC1N 2HA UK");
			Weather("second", "10623 DE");
			Weather("third", "29601 US");
		});

		function Weather(destination, zip)
		{
			var settings =
				{
					cache: false,
					dataType: "jsonp",
					error: function (jqXHR, status, error)
					{
						alert(error);
					},
					success: function (data, status, jqXHR)
					{
						var country, region, city, woeid;

						try
						{
							country = "/" + data.query.results.place.country.content;
						}
						catch (thrown)
						{
						}

						try
						{
							region = "/" + data.query.results.place.admin1.content;
						}
						catch (thrown)
						{
						}

						try
						{
							city = "/" + data.query.results.place.locality1.content;
						}
						catch (thrown)
						{
						}

						try
						{
							woeid = data.query.results.place.woeid;
						}
						catch (thrown)
						{
						}
						if (country)
						{
							country = country.replace(" ", "-").toLowerCase();
						}

						if (region)
						{
							region = region.replace(" ", "-").toLowerCase();
						}

						if (city)
						{
							city = city.replace(" ", "-").toLowerCase();
						}

						var settings =
							{
								cache: false,
								dataType: "jsonp",
								error: function (jqXHR, status, error)
								{
									alert(error);
								},
								success: function (data, status, jqXHR)
								{
									var content = data.query.results.channel.item.description;

									if (content)
									{
										if (!city)
										{
											city = "/" + data.query.results.channel.location.city;

											city = city.replace(" ", "-").toLowerCase();
										}

										var newLink = "http://weather.yahoo.com" + country + region + city;
										var badLink = data.query.results.channel.item.link;

										if ((badLink) && (newLink))
										{
											content = content.replace(badLink, newLink);
										}

										content = content.replace("href=", "target='_blank' href=");

										$("#" + destination + " > h3").text(data.query.results.channel.item.title);
										$("#" + destination + " > p").html(content);
									}
								},
								url: "https://query.yahooapis.com/v1/public/yql?q=select * from weather.forecast where woeid = '" + woeid + "'&format=json&diagnostics=true"
							};

						$.ajax(settings);
					},
					url: "https://query.yahooapis.com/v1/public/yql?q=select * from geo.places where text = '" + zip + "'&format=json&diagnostics=true"
				};

			$.ajax(settings);
		}
	</script>
</body>
</html>
